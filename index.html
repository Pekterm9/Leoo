<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leoo v2</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    :root {
        --primary: #FFD700;
        --dark: #111;
        --light: #f5f6fa;
        --danger: #ff4757;
        --text-grey: #555;
    }

    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', sans-serif; }

    body {
        background: var(--light);
        display: flex;
        height: 100vh;
        overflow: hidden;
    }

    /* --- Sidebar --- */
    .sidebar {
        width: 230px;
        background: var(--dark);
        color: white;
        padding: 30px 20px;
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease;
    }

    .sidebar h1 { font-size: 26px; letter-spacing: 1px; }
    .sidebar p { font-size: 13px; opacity: 0.6; margin-bottom: 40px; }

    .sidebar button {
        background: none;
        border: none;
        color: white;
        padding: 12px 15px;
        margin-bottom: 8px;
        text-align: left;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        transition: background 0.2s;
    }

    .sidebar button:hover { background: #222; }
    
    .sidebar button.active {
        background: #222;
        border-left: 4px solid var(--primary);
        padding-left: 11px; /* Compensate for border */
    }

    /* --- Main Area --- */
    .main {
        flex: 1;
        padding: 40px;
        display: flex;
        flex-direction: column;
    }

    .topbar {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        align-items: center;
    }

    .topbar h2 { font-size: 28px; font-weight: 600; }

    .topbar button {
        background: var(--primary);
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        color: var(--dark);
        transition: transform 0.1s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .topbar button:active { transform: scale(0.96); }

    /* --- List & Items --- */
    #content {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 20px;
        /* Smooth tab switching transition */
        transition: opacity 0.2s ease, transform 0.2s ease;
        opacity: 1;
        transform: translateY(0);
    }

    .content-hidden {
        opacity: 0 !important;
        transform: translateY(10px) !important;
    }

    .list { display: flex; flex-direction: column; gap: 12px; }

    .item {
        background: white;
        padding: 18px;
        border-radius: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.04);
        border-left: 4px solid transparent;
        transition: transform 0.2s, box-shadow 0.2s;
        
        /* Entry Animation */
        animation: slideIn 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }

    .item:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }

    /* Exit Animation Class */
    .item.removing {
        animation: slideOut 0.4s forwards;
        pointer-events: none; /* Prevent double clicks */
    }

    @keyframes slideIn {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideOut {
        to { opacity: 0; transform: translateX(30px); margin-top: -80px; } /* Pull items up */
    }

    .item-left { display: flex; align-items: center; gap: 15px; }

    .check {
        width: 22px;
        height: 22px;
        border: 2px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
    }

    .check:hover { border-color: var(--primary); background: rgba(255, 215, 0, 0.1); }
    
    .check::after {
        content: 'âœ“';
        position: absolute;
        top: -4px; left: 3px;
        color: var(--primary);
        font-weight: bold;
        opacity: 0;
        transform: scale(0);
        transition: all 0.2s;
    }

    .check:active { transform: scale(0.9); }
    
    /* When user clicks check (visual feedback before removal) */
    .check.checked { background: var(--primary); border-color: var(--primary); }
    .check.checked::after { opacity: 1; transform: scale(1); color: #000; }

    .item-name { font-size: 16px; font-weight: 500; }

    .item-right { text-align: right; }
    .warning { font-size: 14px; margin-right: 8px; }
    .date { font-size: 12px; color: #888; display: block; }
    
    /* Status Colors */
    .status-urgent { color: var(--danger); font-weight: bold; }
    .status-soon { color: #ffa502; }

    /* --- Modal --- */
    .modal-bg {
        position: fixed; inset: 0;
        backdrop-filter: blur(4px);
        background: rgba(0,0,0,0.4);
        display: none;
        align-items: center; justify-content: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.2s;
    }
    
    .modal-bg.show { opacity: 1; }

    .modal {
        background: white;
        padding: 30px;
        border-radius: 16px;
        width: 380px;
        display: flex; flex-direction: column; gap: 15px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        transform: scale(0.9);
        transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .modal-bg.show .modal { transform: scale(1); }

    .modal input {
        padding: 12px; border-radius: 8px; border: 1px solid #ddd;
        outline: none; transition: border 0.2s;
    }
    .modal input:focus { border-color: var(--dark); }

    .modal button {
        background: var(--primary); border: none; padding: 12px;
        border-radius: 8px; font-weight: bold; cursor: pointer;
        margin-top: 10px;
    }

    /* --- Stats Canvas Container --- */
    .chart-container {
        position: relative;
        height: 250px;
        width: 100%;
        margin-bottom: 30px;
        background: white;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }
</style>
</head>

<body>

<div class="sidebar">
    <div>
        <h1>Leoo</h1>
        <p>Think smarter, plan wiser</p>
    </div>
    <button id="tasksBtn" class="active">Tasks</button>
    <button id="goalsBtn">Goals</button>
    <button id="statsBtn">Statistics</button>
</div>

<div class="main">
    <div class="topbar">
        <h2 id="workspaceTitle">Tasks</h2>
        <button id="newBtn">+ New</button>
    </div>
    <div id="content"></div>
</div>

<div class="modal-bg" id="modalBg">
    <div class="modal">
        <h3 id="modalTitle">New Task</h3>
        <input type="text" id="itemName" placeholder="What needs to be done?">
        <input type="date" id="itemDate">
        <button id="createBtn">Create</button>
    </div>
</div>

<script>
// --- STATE & CONFIG ---
let currentWorkspace = "tasks";
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let goals = JSON.parse(localStorage.getItem("goals")) || [];
let completedTasks = JSON.parse(localStorage.getItem("completedTasks")) || [];
let completedGoals = JSON.parse(localStorage.getItem("completedGoals")) || [];

// Store chart instances to destroy them properly
let charts = { task: null, goal: null };

// DOM Elements
const content = document.getElementById("content");
const modalBg = document.getElementById("modalBg");
const itemName = document.getElementById("itemName");
const itemDate = document.getElementById("itemDate");

// --- CORE FUNCTIONS ---

function save() {
    localStorage.setItem("tasks", JSON.stringify(tasks));
    localStorage.setItem("goals", JSON.stringify(goals));
    localStorage.setItem("completedTasks", JSON.stringify(completedTasks));
    localStorage.setItem("completedGoals", JSON.stringify(completedGoals));
}

function switchWorkspace(type) {
    if (currentWorkspace === type) return;

    // 1. Fade Out
    content.classList.add("content-hidden");

    // 2. Wait for fade out, then switch data
    setTimeout(() => {
        currentWorkspace = type;
        
        // Update Sidebar UI
        document.querySelectorAll(".sidebar button").forEach(b => b.classList.remove("active"));
        document.getElementById(type + "Btn").classList.add("active");
        
        // Update Title
        const titles = { tasks: "Tasks", goals: "Goals", stats: "Statistics" };
        document.getElementById("workspaceTitle").innerText = titles[type];

        // Toggle 'New' button
        document.getElementById("newBtn").style.display = type === "stats" ? "none" : "block";

        // Render new content
        if (type === "stats") {
            renderStats();
        } else {
            renderList();
        }

        // 3. Fade In
        content.classList.remove("content-hidden");
    }, 200); // Matches CSS transition time
}

function getDaysLeft(dateStr) {
    if(!dateStr) return null;
    
    // Normalize "Today" to midnight
    const today = new Date();
    today.setHours(0,0,0,0);
    
    // Normalize "Due Date" to midnight (handling timezone basic offset)
    const due = new Date(dateStr + "T00:00:00"); 
    
    const diffTime = due - today;
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
}

function renderList() {
    content.innerHTML = "";
    const list = document.createElement("div");
    list.className = "list";
    
    const data = currentWorkspace === "tasks" ? tasks : goals;

    if (data.length === 0) {
        content.innerHTML = `
            <div style="text-align:center; margin-top:50px; opacity:0.5;">
                <h3>No ${currentWorkspace} yet</h3>
                <p>Click "+ New" to get started</p>
            </div>`;
        return;
    }

    data.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "item";
        // Add staggered delay for smoother entry (optional polish)
        div.style.animationDelay = `${index * 0.05}s`;

        const left = document.createElement("div");
        left.className = "item-left";

        const check = document.createElement("div");
        check.className = "check";
        check.onclick = () => completeItem(index, div, check); // Pass element for animation

        const name = document.createElement("span");
        name.className = "item-name";
        name.innerText = item.name;

        left.appendChild(check);
        left.appendChild(name);
        div.appendChild(left);

        if (currentWorkspace === "tasks") {
            const right = document.createElement("div");
            right.className = "item-right";

            const days = getDaysLeft(item.date);
            let text = "";
            let colorClass = "";
            let icon = "";

            if (days < 0) { text = "Overdue"; colorClass = "status-urgent"; icon = "âš ï¸"; }
            else if (days === 0) { text = "Today"; colorClass = "status-urgent"; icon = "ðŸ”¥"; }
            else if (days === 1) { text = "Tomorrow"; colorClass = "status-soon"; }
            else { text = days + " days"; }

            right.innerHTML = `
                <span class="warning">${icon}</span>
                <span class="date ${colorClass}">${text}</span>
            `;
            div.appendChild(right);
        }

        list.appendChild(div);
    });

    content.appendChild(list);
}

function completeItem(index, domElement, checkElement) {
    // 1. Visual Feedback immediately
    checkElement.classList.add("checked");
    
    // 2. Trigger Exit Animation
    domElement.classList.add("removing");

    // 3. Wait for animation, then update data
    setTimeout(() => {
        if (currentWorkspace === "tasks") {
            completedTasks.push({ ...tasks[index], completed: new Date() });
            tasks.splice(index, 1);
        } else {
            completedGoals.push({ ...goals[index], completed: new Date() });
            goals.splice(index, 1);
        }
        save();
        renderList();
    }, 400); // Matches CSS animation duration
}

function renderStats() {
    content.innerHTML = `
        <div class="chart-container"><canvas id="tasksChart"></canvas></div>
        <div class="chart-container"><canvas id="goalsChart"></canvas></div>
    `;

    // Wait a tick for DOM to update
    setTimeout(() => {
        const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        
        const getMonthlyData = (arr) => {
            const counts = new Array(12).fill(0);
            arr.forEach(i => {
                const d = new Date(i.completed);
                counts[d.getMonth()]++;
            });
            return counts;
        };

        // DESTROY OLD CHARTS IF EXIST
        if (charts.task) charts.task.destroy();
        if (charts.goal) charts.goal.destroy();

        charts.task = new Chart(document.getElementById("tasksChart"), {
            type: "bar",
            data: {
                labels: months,
                datasets: [{ 
                    label: "Tasks Completed", 
                    data: getMonthlyData(completedTasks),
                    backgroundColor: "#FFD700",
                    borderRadius: 4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });

        charts.goal = new Chart(document.getElementById("goalsChart"), {
            type: "line",
            data: {
                labels: months,
                datasets: [{ 
                    label: "Goals Achieved", 
                    data: getMonthlyData(completedGoals),
                    borderColor: "#111",
                    tension: 0.4,
                    fill: true,
                    backgroundColor: "rgba(0,0,0,0.05)"
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });
    }, 0);
}

// --- EVENT LISTENERS ---

// Modal Handling
document.getElementById("newBtn").onclick = () => {
    modalBg.style.display = "flex";
    // Small timeout to allow display:flex to apply before adding opacity class
    setTimeout(() => modalBg.classList.add("show"), 10);
    
    document.getElementById("modalTitle").innerText = currentWorkspace === "tasks" ? "New Task" : "New Goal";
    itemDate.style.display = currentWorkspace === "tasks" ? "block" : "none";
    itemName.value = "";
    itemDate.value = new Date().toISOString().split("T")[0]; // Default to today
    itemName.focus();
};

function closeModal() {
    modalBg.classList.remove("show");
    setTimeout(() => { modalBg.style.display = "none"; }, 200);
}

modalBg.onclick = (e) => { if (e.target === modalBg) closeModal(); };

document.getElementById("createBtn").onclick = () => {
    if (!itemName.value.trim()) return;

    const newItem = { name: itemName.value, date: itemDate.value };
    
    if (currentWorkspace === "tasks") tasks.push(newItem);
    else goals.push(newItem);

    closeModal();
    save();
    
    // Render immediately (animation handles the rest)
    renderList();
};

// Sidebar Navigation
document.getElementById("tasksBtn").onclick = () => switchWorkspace("tasks");
document.getElementById("goalsBtn").onclick = () => switchWorkspace("goals");
document.getElementById("statsBtn").onclick = () => switchWorkspace("stats");

// Initial Load
renderList();

</script>
</body>
</html>
